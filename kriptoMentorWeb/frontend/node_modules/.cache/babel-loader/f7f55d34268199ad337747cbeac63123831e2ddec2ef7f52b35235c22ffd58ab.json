{"ast":null,"code":"import React,{useState,useEffect,useCallback,useRef,memo}from'react';import'./MarketPage.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MarketItem=/*#__PURE__*/memo(_ref=>{let{item}=_ref;const isUp=item.price_change_percentage_24h>=0;return/*#__PURE__*/_jsxs(\"div\",{className:\"market-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"market-row\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"symbol\",children:item.symbol.toUpperCase()}),/*#__PURE__*/_jsxs(\"span\",{className:\"price\",children:[\"$\",item.current_price.toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"market-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"market-cap\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"small-label\",children:\"Market Cap:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"small-value\",children:[\"$\",item.market_cap.toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"change-container\",children:[/*#__PURE__*/_jsx(\"span\",{className:`arrow ${isUp?'up':'down'}`,children:isUp?'▲':'▼'}),/*#__PURE__*/_jsxs(\"span\",{className:`change-text ${isUp?'up':'down'}`,children:[Math.abs(item.price_change_percentage_24h).toFixed(2),\"%\"]})]})]})]});});export default function MarketPage(){const[coins,setCoins]=useState([]);const[loading,setLoading]=useState(true);const pendingRef=useRef({});const timeoutRef=useRef(null);const wsRef=useRef(null);const fetchMarketData=async()=>{try{const res=await fetch('https://api.coingecko.com/api/v3/coins/markets'+'?vs_currency=usd&order=market_cap_desc&per_page=20&page=1&price_change_percentage=24h');const data=await res.json();setCoins(data);}catch(err){console.error('Market verisi hatası:',err);}finally{setLoading(false);}};const initWebSocket=useCallback(symbols=>{if(wsRef.current)wsRef.current.close();const streams=symbols.map(s=>`${s.toLowerCase()}usdt@ticker`).join('/');const url=`wss://stream.binance.com:9443/stream?streams=${streams}`;const ws=new WebSocket(url);wsRef.current=ws;ws.onmessage=e=>{const msg=JSON.parse(e.data).data;const sym=msg.s.replace('USDT','').toLowerCase();pendingRef.current[sym]={price:parseFloat(msg.c),change:parseFloat(msg.P)};if(!timeoutRef.current){timeoutRef.current=setTimeout(()=>{setCoins(prev=>prev.map(c=>{const upd=pendingRef.current[c.symbol.toLowerCase()];return upd?{...c,current_price:upd.price,price_change_percentage_24h:upd.change}:c;}));pendingRef.current={};timeoutRef.current=null;},1000);}};ws.onerror=err=>console.error('WS hata',err);ws.onclose=()=>console.log('WS kapandı');},[]);useEffect(()=>{fetchMarketData();},[]);useEffect(()=>{if(coins.length){initWebSocket(coins.map(c=>c.symbol));}return()=>{if(wsRef.current)wsRef.current.close();if(timeoutRef.current)clearTimeout(timeoutRef.current);};},[coins,initWebSocket]);if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"market-page loader\",children:/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"market-page\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"market-header\",children:\"G\\xFCncel Piyasa Verileri\"}),/*#__PURE__*/_jsx(\"div\",{className:\"market-list\",children:coins.map(coin=>/*#__PURE__*/_jsx(MarketItem,{item:coin},coin.id))})]});}","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","memo","jsx","_jsx","jsxs","_jsxs","MarketItem","_ref","item","isUp","price_change_percentage_24h","className","children","symbol","toUpperCase","current_price","toLocaleString","market_cap","Math","abs","toFixed","MarketPage","coins","setCoins","loading","setLoading","pendingRef","timeoutRef","wsRef","fetchMarketData","res","fetch","data","json","err","console","error","initWebSocket","symbols","current","close","streams","map","s","toLowerCase","join","url","ws","WebSocket","onmessage","e","msg","JSON","parse","sym","replace","price","parseFloat","c","change","P","setTimeout","prev","upd","onerror","onclose","log","length","clearTimeout","coin","id"],"sources":["C:/Users/Yusuf Uygur/Documents/GitHub/KriptoMentorSon/kriptoMentorWeb/frontend/src/pages/MarketPage.js"],"sourcesContent":["import React, {\r\n  useState,\r\n  useEffect,\r\n  useCallback,\r\n  useRef,\r\n  memo\r\n} from 'react';\r\nimport './MarketPage.css';\r\n\r\nconst MarketItem = memo(({ item }) => {\r\n  const isUp = item.price_change_percentage_24h >= 0;\r\n  return (\r\n    <div className=\"market-card\">\r\n      <div className=\"market-row\">\r\n        <span className=\"symbol\">{item.symbol.toUpperCase()}</span>\r\n        <span className=\"price\">${item.current_price.toLocaleString()}</span>\r\n      </div>\r\n      <div className=\"market-row\">\r\n        <div className=\"market-cap\">\r\n          <span className=\"small-label\">Market Cap:</span>\r\n          <span className=\"small-value\">\r\n            ${item.market_cap.toLocaleString()}\r\n          </span>\r\n        </div>\r\n        <div className=\"change-container\">\r\n          <span\r\n            className={`arrow ${isUp ? 'up' : 'down'}`}\r\n          >{isUp ? '▲' : '▼'}</span>\r\n          <span className={`change-text ${isUp ? 'up' : 'down'}`}>\r\n            {Math.abs(item.price_change_percentage_24h).toFixed(2)}%\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default function MarketPage() {\r\n  const [coins, setCoins] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const pendingRef = useRef({});\r\n  const timeoutRef = useRef(null);\r\n  const wsRef = useRef(null);\r\n\r\n  const fetchMarketData = async () => {\r\n    try {\r\n      const res = await fetch(\r\n        'https://api.coingecko.com/api/v3/coins/markets' +\r\n        '?vs_currency=usd&order=market_cap_desc&per_page=20&page=1&price_change_percentage=24h'\r\n      );\r\n      const data = await res.json();\r\n      setCoins(data);\r\n    } catch (err) {\r\n      console.error('Market verisi hatası:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const initWebSocket = useCallback((symbols) => {\r\n    if (wsRef.current) wsRef.current.close();\r\n\r\n    const streams = symbols.map(s => `${s.toLowerCase()}usdt@ticker`).join('/');\r\n    const url = `wss://stream.binance.com:9443/stream?streams=${streams}`;\r\n    const ws = new WebSocket(url);\r\n    wsRef.current = ws;\r\n\r\n    ws.onmessage = e => {\r\n      const msg = JSON.parse(e.data).data;\r\n      const sym = msg.s.replace('USDT', '').toLowerCase();\r\n      pendingRef.current[sym] = {\r\n        price: parseFloat(msg.c),\r\n        change: parseFloat(msg.P)\r\n      };\r\n\r\n      if (!timeoutRef.current) {\r\n        timeoutRef.current = setTimeout(() => {\r\n          setCoins(prev =>\r\n            prev.map(c => {\r\n              const upd = pendingRef.current[c.symbol.toLowerCase()];\r\n              return upd\r\n                ? {\r\n                    ...c,\r\n                    current_price: upd.price,\r\n                    price_change_percentage_24h: upd.change\r\n                  }\r\n                : c;\r\n            })\r\n          );\r\n          pendingRef.current = {};\r\n          timeoutRef.current = null;\r\n        }, 1000);\r\n      }\r\n    };\r\n\r\n    ws.onerror = err => console.error('WS hata', err);\r\n    ws.onclose = () => console.log('WS kapandı');\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchMarketData();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (coins.length) {\r\n      initWebSocket(coins.map(c => c.symbol));\r\n    }\r\n    return () => {\r\n      if (wsRef.current) wsRef.current.close();\r\n      if (timeoutRef.current) clearTimeout(timeoutRef.current);\r\n    };\r\n  }, [coins, initWebSocket]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"market-page loader\">\r\n        <div className=\"spinner\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"market-page\">\r\n      <h1 className=\"market-header\">Güncel Piyasa Verileri</h1>\r\n      <div className=\"market-list\">\r\n        {coins.map(coin => (\r\n          <MarketItem key={coin.id} item={coin} />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}